name: Test CLI Launchers on all the platforms
on:
  push:
  workflow_dispatch:

jobs:
  linux-x64:
    name: Deploy and Test on Linux x64 architecture
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'sbt'
      - name: Build the launcher command
        run: sbt "dist-linux-x64/pack"
      - run: ./dist/linux-x64/target/pack/bin/scala --version

  linux-aarch64:
    name: Deploy and Test on Linux ARM64 architecture
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'sbt'
      # https://github.com/actions/runner-images/issues/9369
      - name: Install sbt
        run: brew install sbt
      - name: Build the launcher command
        run: sbt "dist-linux-aarch64/pack"
      - run: ./dist/linux-aarch64/target/pack/bin/scala --version

  mac-x64:
    name: Deploy and Test on Mac x64 architecture
    runs-on: macos-13
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'sbt'
      # https://github.com/actions/runner-images/issues/9369
      - name: Install sbt
        run: brew install sbt
      - name: Build the launcher command
        run: sbt "dist-mac-x64/pack"
      - run: ./dist/mac-x64/target/pack/bin/scala --version

  mac-aarch64:
    name: Deploy and Test on Mac ARM64 architecture
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'sbt'
      # https://github.com/actions/runner-images/issues/9369
      - name: Install sbt
        run: brew install sbt
      - name: Build the launcher command
        run: sbt "dist-mac-aarch64/pack"
      - run: ./dist/mac-aarch64/target/pack/bin/scala --version

  win-x64:
    name: Deploy and Test on Windows x64 architecture
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'sbt'
      - name: Build the launcher command
        run: sbt "dist-win-x64/pack"
      - run: ./dist/win-x64/target/pack/bin/scala --version
